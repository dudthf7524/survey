<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">
	
	<sql id = "search">
		<choose>
			<when test = "searchOption == 'memberId_memberName'">
				and memberId like '%' || #{searchData} || '%' or
				memberName like '%' || #{searchData} || '%'
			</when>
			<when test = "searchOption !=null and searchOption != '' and searchData != null and searchData != '' ">
				and ${searchOption} Like '%' || #{searchData} || '%'
			</when>
			<otherwise>
				
			</otherwise>
		</choose>
	</sql>

	<select id = "getSelectAll" resultType = "com.example.survey.dto.MemberDTO">
		select * from (select A.*, Rownum Rnum from (
		
			select * from member where 1=1
			<include refid = "search"></include>
			order by memberNo desc
		
		<![CDATA[ 
			) A) where Rnum >= #{startRecord} and Rnum <= #{lastRecord}
		]]>
	</select>
	<select id = "getSelectOne" resultType = "com.example.survey.dto.MemberDTO">
		select * from member where memberNo = #{memberNo}
	</select>
	
	<insert id = "setInsert" >
		insert into member values (seq_member.nextval, #{memberName}, #{memberGender}, #{memberId}, #{memberPasswd},
		#{memberPhone1}, #{memberPhone2}, #{memberPhone3}, #{memberEmail1}, #{memberEmail2}, sysdate, 1)
	</insert>
	
	<update id = "setUpdate">
		update member set 
		memberName = #{memberName},
		memberGender = #{memberGender},
		memberId = #{memberId},
		memberPasswd = #{memberPasswd},
		memberPhone1 = #{memberPhone1},
		memberPhone2 = #{memberPhone2},
		memberPhone3 = #{memberPhone3},
		memberEmail1 = #{memberEmail1},
		memberEmail2 = #{memberEmail2}
		where memberNo = #{memberNo}
	</update>
	
	<delete id = "setDelete">
		delete from member where memberNo = #{memberNo}
	</delete>
	
	<select id = "login" resultType = "com.example.survey.dto.MemberDTO">
		select memberNo, memberId, memberName, memberPasswd, rank from member where memberId = #{memberId}
	</select>
	
	
	<select id = "getTotalRecord" resultType = "int">
		select count(*) from member where 1=1
		<include refid = "search"></include>
	</select>
	
	
	
</mapper>